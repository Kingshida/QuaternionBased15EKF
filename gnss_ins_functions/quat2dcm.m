function Cnb = quat2dcm(q)
%---------------------------------------------
%   quat2dcm : Forms a direction cosine matrix
%   from an attitude representation given in
%   quaternions.
%   Usage : Cnb = quat2dcm([q0,q1,q2,q3])
%   
%   Kerry Sun 02/07/2020
%   Demoz Gebre 7/2/98

%----------------------------------------------
% old version...
% q0 = q(1); q1 = q(2); q2 = q(3); q3 = q(4);
% 
% C(1,1) = 1 - 2*(q2*q2 + q3*q3);
% C(2,2) = 1 - 2*(q3*q3 + q1*q1);
% C(3,3) = 1 - 2*(q1*q1 + q2*q2);
% 
% C(2,1) = 2*(q1*q2 - q3*q0);
% C(3,1) = 2*(q3*q1 + q2*q0);
% 
% C(1,2) = 2*(q3*q0 + q1*q2);
% C(3,2) = 2*(q2*q3 - q0*q1);
% 
% C(1,3) = 2*(q3*q1 - q2*q0);
% C(2,3) = 2*(q2*q3 + q0*q1);

%*************************************************************************%
% old version...
q0 = q(1); q1 = q(2); q2 = q(3); q3 = q(4);

Cnb(1,1) = -1 + 2*(q0*q0 + q1*q1);
Cnb(2,2) = -1 + 2*(q0*q0 + q2*q2);
Cnb(3,3) = -1 + 2*(q0*q0 + q3*q3);

Cnb(1,2) = 2*(q1*q2 + q3*q0);
Cnb(1,3) = 2*(q3*q1 - q2*q0);

Cnb(2,1) = 2*(-q3*q0 + q1*q2);
Cnb(2,3) = 2*(q2*q3 + q0*q1);

Cnb(3,1) = 2*(q3*q1 + q2*q0);
Cnb(3,2) = 2*(q2*q3 - q0*q1);

%*************************************************************************%